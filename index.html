<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>GSECARS Tomography Software &#8212; IDL Tomography 1-0-47-g305c95a documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="icon" href="_static/favicon_t.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">
          IDL Tomography</a>
        <span class="navbar-text navbar-version pull-left"><b>1-0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">GSECARS Tomography Software</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#install-idl">Install IDL</a></li>
<li><a class="reference internal" href="#install-idl-tomography">Install IDL_Tomography</a></li>
</ul>
</li>
<li><a class="reference internal" href="#starting-tomo-display">Starting tomo_display</a></li>
<li><a class="reference internal" href="#file-formats">File formats</a><ul>
<li><a class="reference internal" href="#raw-data">Raw data</a></li>
<li><a class="reference internal" href="#preprocessed-normalized-data">Preprocessed (normalized) data</a></li>
<li><a class="reference internal" href="#reconstructed-data">Reconstructed data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-tomo-display">Using tomo_display</a></li>
<li><a class="reference internal" href="#visualizing-results">Visualizing results</a><ul>
<li><a class="reference internal" href="#visualize-with-tomo-display">Visualize with tomo_display</a></li>
<li><a class="reference internal" href="#visualize-with-imagej">Visualize with ImageJ</a><ul>
<li><a class="reference internal" href="#limitations-in-imagej">Limitations in ImageJ</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#scripting-and-batch-processing">Scripting and batch processing</a></li>
<li><a class="reference internal" href="#benchmarks">Benchmarks</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/index.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="gsecars-tomography-software">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">GSECARS Tomography Software</a><a class="headerlink" href="#gsecars-tomography-software" title="Permalink to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Mark Rivers, University of Chicago</p>
</dd>
</dl>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#gsecars-tomography-software" id="id1">GSECARS Tomography Software</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p></li>
<li><p><a class="reference internal" href="#installation" id="id3">Installation</a></p>
<ul>
<li><p><a class="reference internal" href="#install-idl" id="id4">Install IDL</a></p></li>
<li><p><a class="reference internal" href="#install-idl-tomography" id="id5">Install IDL_Tomography</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#starting-tomo-display" id="id6">Starting tomo_display</a></p></li>
<li><p><a class="reference internal" href="#file-formats" id="id7">File formats</a></p>
<ul>
<li><p><a class="reference internal" href="#raw-data" id="id8">Raw data</a></p></li>
<li><p><a class="reference internal" href="#preprocessed-normalized-data" id="id9">Preprocessed (normalized) data</a></p></li>
<li><p><a class="reference internal" href="#reconstructed-data" id="id10">Reconstructed data</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-tomo-display" id="id11">Using tomo_display</a></p></li>
<li><p><a class="reference internal" href="#visualizing-results" id="id12">Visualizing results</a></p>
<ul>
<li><p><a class="reference internal" href="#visualize-with-tomo-display" id="id13">Visualize with tomo_display</a></p></li>
<li><p><a class="reference internal" href="#visualize-with-imagej" id="id14">Visualize with ImageJ</a></p>
<ul>
<li><p><a class="reference internal" href="#limitations-in-imagej" id="id15">Limitations in ImageJ</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#scripting-and-batch-processing" id="id16">Scripting and batch processing</a></p></li>
<li><p><a class="reference internal" href="#benchmarks" id="id17">Benchmarks</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>This document describes how to install the required software to reconstruct and
visualize tomography data from the 13-BM-D beamline.
This includes data collected both on the upstream tomography table, and that collected in the 250-ton press.
This software can be installed on Linux and Windows.
A computer with at least 32 GB of RAM, at least 8 cores, and a fast solid-state hard disk for the data
is recommended.</p>
<p>The software consists of the following components:</p>
<ul class="simple">
<li><p>C++ library containing optimized code for preprocessing and reconstruction</p></li>
<li><p><a class="reference external" href="https://www.l3harrisgeospatial.com/Software-Technology/IDL">IDL</a> class library called <code class="docutils literal notranslate"><span class="pre">tomo</span></code> that does the following:</p>
<ul>
<li><p>Read raw data files</p></li>
<li><p>Preprocess using the C++ library</p></li>
<li><p>Optimize rotation center</p></li>
<li><p>Reconstruct using the C++ library</p></li>
<li><p>Save reconstructed data</p></li>
<li><p>Save and restore preprocessing and reconstruction parameters</p></li>
</ul>
</li>
<li><p>IDL visualization class called <code class="docutils literal notranslate"><span class="pre">image_display</span></code> that can display 2-D and 3-D data</p></li>
<li><p>IDL GUI program called <code class="docutils literal notranslate"><span class="pre">tomo_display</span></code> that calls the <code class="docutils literal notranslate"><span class="pre">tomo</span></code> and <code class="docutils literal notranslate"><span class="pre">image_display</span></code> classes</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">tomo</span></code> and <code class="docutils literal notranslate"><span class="pre">tomo_display</span></code> are provided in source code form in the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_Tomography</a> repository.
That repository contains DLLs (Windows) and shareable libraries (Linux) to run
the IDL software without compiling any code.  <code class="docutils literal notranslate"><span class="pre">tomo_display</span></code> is also available as as an IDL .sav
file, <a class="reference external" href="https://cars.uchicago.edu/data/tomography/tomo_display/tomo_display.sav">tomo_display.sav</a>, that can be run for free in the IDL Virtual Machine. <code class="docutils literal notranslate"><span class="pre">image_display</span></code> is available in a
separate <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_imaging</a> repository.</p>
</section>
<section id="installation">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Installation</a><a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>The following instructions are for installation for sites who have an IDL license which will use the full version of IDL
and for those without a license which will use the IDL Virtual Machine.</p>
<section id="install-idl">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Install IDL</a><a class="headerlink" href="#install-idl" title="Permalink to this heading">¶</a></h3>
<p>All sites must install <a class="reference external" href="https://www.l3harrisgeospatial.com/Software-Technology/IDL">IDL</a>, whether they will use the licensed version or the Virtual Machine.
You should <a class="reference external" href="https://www.l3harrisgeospatial.com/Company/Create-Account?returnurl=https%3a%2f%2fwww.l3harrisgeospatial.com%2fSoftware-Technology%2fIDL">register on the Harris site</a>
and then you can download the software and follow the installation
instructions. If you want to get started immediately with the IDL Virtual Machine you can
<a class="reference external" href="https://cars.uchicago.edu/data/idl">download IDL here</a>,
but please also register with Harris.</p>
</section>
<section id="install-idl-tomography">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Install IDL_Tomography</a><a class="headerlink" href="#install-idl-tomography" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Create a directory that will contain the IDL tomography routines. This might be C:GSECARS_tomography on Windows
or /home/youraccount/GSECARS_tomography on Linux.</p></li>
<li><p>Clone the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_Tomography</a> and <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_Imaging</a> repositories into that directory. This must be done even if you
are using the IDL Virtual Machine because that repository contains the required DLLs for Windows and shareable
libraries for Linux.</p></li>
<li><p>If you are running the licensed version of IDL clone the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_Imaging</a> repository into the same directory.</p></li>
<li><p>If you are running the IDL Virtual Machine download <a class="reference external" href="https://cars.uchicago.edu/data/tomography/tomo_display/tomo_display.sav">tomo_display.sav</a> to a folder like C:GSECARS_tomography.</p></li>
<li><p>If you are using the licensed version of IDL you need to add the directory you created to the IDL_PATH.
In the IDLDE use Window/Preferences/IDL/Paths to add that directory to the IDL Path, and check the box
to also search subdirectories.
Alternatively you can set the IDL_PATH environment variable to e.g. “&lt;IDL_DEFAULT&gt;:+/home/myaccount/GSECARS_tomography”.
The + symbol means to search subdirectories.</p></li>
<li><p>On Windows add the IDL_tomography folder to your PATH environment variable.
This can be done with Control Panel/System/Advanced/Environment Variables.
This is necessary for both the licensed and Virtual Machine versions of IDL to find libfftw3f-3.dll.</p></li>
<li><p>If you are using the IDL Virtual machine you must to the following to define the location of the tomoRecon
shareable library:</p>
<ul>
<li><p>On Linux define the environment variable TOMO_RECON_SHARE to point to the complete path to tomoRecon_linux_x86_64.so,
which is contained in the IDL_Tomography software downloaded above.
Example: <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">TOMO_RECON_SHARE=/usr/local/tomography/idl/tomoRecon_linux_x86_64.so</span></code></p></li>
<li><p>On Windows define the environment variable TOMO_RECON_SHARE to point to the complete path to tomoRecon_Win32_x86_64.dll.
Example: <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">TOMO_RECON_SHARE=C:\tomography\idl\tomoRecon_Win32_x86.dll</span></code>. This can be done in Control Panel/System as well.</p></li>
</ul>
</li>
<li><p>On Linux make sure the fftw-devel package is installed.  This is required for reconstruction.</p></li>
</ul>
</section>
</section>
<section id="starting-tomo-display">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Starting tomo_display</a><a class="headerlink" href="#starting-tomo-display" title="Permalink to this heading">¶</a></h2>
<p>If you are running the licensed version of IDL then start IDL and type the IDL command <em>tomo_display</em>.
If you are running the IDL Virtual Machine on Windows then double-click on the tomo_display.sav file,
or open the IDL Virtual Machine from the Windows Start menu and browse for the file.
On Linux type the command <code class="docutils literal notranslate"><span class="pre">idl</span> <span class="pre">-vm=tomo_display.sav</span></code></p>
</section>
<section id="file-formats">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">File formats</a><a class="headerlink" href="#file-formats" title="Permalink to this heading">¶</a></h2>
<section id="raw-data">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Raw data</a><a class="headerlink" href="#raw-data" title="Permalink to this heading">¶</a></h3>
<p>From May 2014 to July 2020 the raw data is stored in netCDF files with the extension “.nc”.
There are three netCDF files per dataset.  Two are the flat field images collected at
the beginning and end of the scan, the third contains all of the projections.
An ASCII text file with the extension “.setup” contains the metadata,
including the sample information, x-ray energy, and pixel size.</p>
<p>Beginning in July 2020 the raw data is stored in HDF5 files with the extension “.h5”.
There is one HDF5 file per dataset, and it contains the flat field images and the projections.
It also contains metadata including the positions of many motors on the beamline, the ring current,
the tomography data collection parameters, the sample and optics information, and more.
An ASCII text file with the extension “.config” contains the tomography data collection parameters,
the sample and optics information, and more.</p>
</section>
<section id="preprocessed-normalized-data">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Preprocessed (normalized) data</a><a class="headerlink" href="#preprocessed-normalized-data" title="Permalink to this heading">¶</a></h3>
<p>Prior to January 2023 preprocessed data was written to disk as netCDF files with a file name that ends in “.volume”.
Prior to July 2020 these files were written by <em>tomo_display</em>, while from July 2020 to January 2023 they were written
by a Python script called preprocess_13bm.py.  Beginning with the new version of <em>tomo_display</em> in January 2023 the
preprocessed data generally not written to disk at all, it is kept in memory.  This significantly improves
the reconstruction speed.  <em>tomo_display</em> can optionally save the preprocessed data either as a netCDF file whose
name ends in “norm.nc” or an HDF5 file whose name ends in “norm.h5”.</p>
</section>
<section id="reconstructed-data">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Reconstructed data</a><a class="headerlink" href="#reconstructed-data" title="Permalink to this heading">¶</a></h3>
<p>Prior to January 2023 the reconstructed files were stored in netCDF format with a file name that ends
in “recon.volume”.  tomo_display can now stored reconstructed files in either netCDF format with a file
name that ends in “recon.nc”, or in HDF5 format with a file name that ends in “recon.h5”.  HDF5 is 2-3 times
faster to write, and is generally recommended.  However, there are some limitations in reading HDF5 files into
ImageJ which are discussed below.</p>
</section>
</section>
<section id="using-tomo-display">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Using tomo_display</a><a class="headerlink" href="#using-tomo-display" title="Permalink to this heading">¶</a></h2>
</section>
<section id="visualizing-results">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Visualizing results</a><a class="headerlink" href="#visualizing-results" title="Permalink to this heading">¶</a></h2>
<section id="visualize-with-tomo-display">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Visualize with tomo_display</a><a class="headerlink" href="#visualize-with-tomo-display" title="Permalink to this heading">¶</a></h3>
</section>
<section id="visualize-with-imagej">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Visualize with ImageJ</a><a class="headerlink" href="#visualize-with-imagej" title="Permalink to this heading">¶</a></h3>
<section id="limitations-in-imagej">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Limitations in ImageJ</a><a class="headerlink" href="#limitations-in-imagej" title="Permalink to this heading">¶</a></h4>
</section>
</section>
</section>
<section id="scripting-and-batch-processing">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Scripting and batch processing</a><a class="headerlink" href="#scripting-and-batch-processing" title="Permalink to this heading">¶</a></h2>
</section>
<section id="benchmarks">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">Benchmarks</a><a class="headerlink" href="#benchmarks" title="Permalink to this heading">¶</a></h2>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Mark Rivers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>