<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>GSECARS Tomography Software &#8212; IDL Tomography 1-0-53-g889fd72 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="icon" href="_static/favicon_t.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">
          IDL Tomography</a>
        <span class="navbar-text navbar-version pull-left"><b>1-0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">GSECARS Tomography Software</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#install-idl">Install IDL</a></li>
<li><a class="reference internal" href="#install-idl-tomography">Install IDL_Tomography</a></li>
</ul>
</li>
<li><a class="reference internal" href="#file-formats">File formats</a><ul>
<li><a class="reference internal" href="#raw-data">Raw data</a></li>
<li><a class="reference internal" href="#preprocessed-normalized-data">Preprocessed (normalized) data</a></li>
<li><a class="reference internal" href="#reconstructed-data">Reconstructed data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tomo-display-quick-start">tomo_display Quick Start</a><ul>
<li><a class="reference internal" href="#read-camera-file">Read camera file</a></li>
<li><a class="reference internal" href="#visualizing-raw-data">Visualizing raw data</a></li>
<li><a class="reference internal" href="#preprocessing">Preprocessing</a></li>
<li><a class="reference internal" href="#visualizing-normalized-data">Visualizing normalized data</a></li>
<li><a class="reference internal" href="#optimizing-rotation-center">Optimizing rotation center</a></li>
<li><a class="reference internal" href="#reconstruction">Reconstruction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#visualize-with-imagej">Visualize with ImageJ</a><ul>
<li><a class="reference internal" href="#limitations-in-imagej">Limitations in ImageJ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scripting-and-batch-processing">Scripting and batch processing</a></li>
<li><a class="reference internal" href="#benchmarks">Benchmarks</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/index.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="gsecars-tomography-software">
<h1><a class="toc-backref" href="#id7" role="doc-backlink">GSECARS Tomography Software</a><a class="headerlink" href="#gsecars-tomography-software" title="Permalink to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Mark Rivers, University of Chicago</p>
</dd>
</dl>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#gsecars-tomography-software" id="id7">GSECARS Tomography Software</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id8">Overview</a></p></li>
<li><p><a class="reference internal" href="#installation" id="id9">Installation</a></p>
<ul>
<li><p><a class="reference internal" href="#install-idl" id="id10">Install IDL</a></p></li>
<li><p><a class="reference internal" href="#install-idl-tomography" id="id11">Install IDL_Tomography</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#file-formats" id="id12">File formats</a></p>
<ul>
<li><p><a class="reference internal" href="#raw-data" id="id13">Raw data</a></p></li>
<li><p><a class="reference internal" href="#preprocessed-normalized-data" id="id14">Preprocessed (normalized) data</a></p></li>
<li><p><a class="reference internal" href="#reconstructed-data" id="id15">Reconstructed data</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tomo-display-quick-start" id="id16">tomo_display Quick Start</a></p>
<ul>
<li><p><a class="reference internal" href="#read-camera-file" id="id17">Read camera file</a></p></li>
<li><p><a class="reference internal" href="#visualizing-raw-data" id="id18">Visualizing raw data</a></p></li>
<li><p><a class="reference internal" href="#preprocessing" id="id19">Preprocessing</a></p></li>
<li><p><a class="reference internal" href="#visualizing-normalized-data" id="id20">Visualizing normalized data</a></p></li>
<li><p><a class="reference internal" href="#optimizing-rotation-center" id="id21">Optimizing rotation center</a></p></li>
<li><p><a class="reference internal" href="#reconstruction" id="id22">Reconstruction</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#visualize-with-imagej" id="id23">Visualize with ImageJ</a></p>
<ul>
<li><p><a class="reference internal" href="#limitations-in-imagej" id="id24">Limitations in ImageJ</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#scripting-and-batch-processing" id="id25">Scripting and batch processing</a></p></li>
<li><p><a class="reference internal" href="#benchmarks" id="id26">Benchmarks</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>This document describes how to install the required software to reconstruct and
visualize tomography data from the 13-BM-D beamline.
This includes data collected both on the upstream tomography table, and that collected in the 250-ton press.
This software can be installed on Linux and Windows.
A computer with at least 32 GB of RAM, at least 8 cores, and a fast solid-state hard disk for the data
is recommended.</p>
<p>The software consists of the following components:</p>
<ul class="simple">
<li><p>C++ library containing optimized code for preprocessing and reconstruction</p></li>
<li><p><a class="reference external" href="https://www.l3harrisgeospatial.com/Software-Technology/IDL">IDL</a> class library called <code class="docutils literal notranslate"><span class="pre">tomo</span></code> that does the following:</p>
<ul>
<li><p>Read raw data files</p></li>
<li><p>Preprocess using the C++ library</p></li>
<li><p>Optimize rotation center</p></li>
<li><p>Reconstruct using the C++ library</p></li>
<li><p>Save reconstructed data</p></li>
<li><p>Save and restore preprocessing and reconstruction parameters</p></li>
</ul>
</li>
<li><p>IDL visualization class called <code class="docutils literal notranslate"><span class="pre">image_display</span></code> that can display 2-D and 3-D data</p></li>
<li><p>IDL GUI program called <code class="docutils literal notranslate"><span class="pre">tomo_display</span></code> that calls the <code class="docutils literal notranslate"><span class="pre">tomo</span></code> and <code class="docutils literal notranslate"><span class="pre">image_display</span></code> classes</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">tomo</span></code> and <code class="docutils literal notranslate"><span class="pre">tomo_display</span></code> are provided in source code form in the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_Tomography</a> repository.
That repository contains DLLs (Windows) and shareable libraries (Linux) to run
the IDL software without compiling any code.  <code class="docutils literal notranslate"><span class="pre">tomo_display</span></code> is also available as as an IDL .sav
file, <a class="reference external" href="https://cars.uchicago.edu/data/tomography/tomo_display/tomo_display.sav">tomo_display.sav</a>, that can be run for free in the IDL Virtual Machine. <code class="docutils literal notranslate"><span class="pre">image_display</span></code> is available in a
separate <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_imaging</a> repository.</p>
</section>
<section id="installation">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Installation</a><a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>The following instructions are for installation for sites who have an IDL license which will use the full version of IDL
and for those without a license which will use the IDL Virtual Machine.</p>
<section id="install-idl">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Install IDL</a><a class="headerlink" href="#install-idl" title="Permalink to this heading">¶</a></h3>
<p>All sites must install <a class="reference external" href="https://www.l3harrisgeospatial.com/Software-Technology/IDL">IDL</a>, whether they will use the licensed version or the Virtual Machine.
You should <a class="reference external" href="https://www.l3harrisgeospatial.com/Company/Create-Account?returnurl=https%3a%2f%2fwww.l3harrisgeospatial.com%2fSoftware-Technology%2fIDL">register on the Harris site</a>
and then you can download the software and follow the installation
instructions. If you want to get started immediately with the IDL Virtual Machine you can
<a class="reference external" href="https://cars.uchicago.edu/data/idl">download IDL here</a>,
but please also register with Harris.</p>
</section>
<section id="install-idl-tomography">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Install IDL_Tomography</a><a class="headerlink" href="#install-idl-tomography" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Create a directory that will contain the IDL tomography routines. This might be C:GSECARS_tomography on Windows
or /home/youraccount/GSECARS_tomography on Linux.</p></li>
<li><p>Clone the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_Tomography</a> and <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_Imaging</a> repositories into that directory. This must be done even if you
are using the IDL Virtual Machine because that repository contains the required DLLs for Windows and shareable
libraries for Linux.</p></li>
<li><p>If you are running the licensed version of IDL clone the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL_Imaging</a> repository into the same directory.</p></li>
<li><p>If you are running the IDL Virtual Machine download <a class="reference external" href="https://cars.uchicago.edu/data/tomography/tomo_display/tomo_display.sav">tomo_display.sav</a> to a folder like C:GSECARS_tomography.</p></li>
<li><p>If you are using the licensed version of IDL you need to add the directory you created to the IDL_PATH.
In the IDLDE use Window/Preferences/IDL/Paths to add that directory to the IDL Path, and check the box
to also search subdirectories.
Alternatively you can set the IDL_PATH environment variable to e.g. “&lt;IDL_DEFAULT&gt;:+/home/myaccount/GSECARS_tomography”.
The + symbol means to search subdirectories.</p></li>
<li><p>On Windows add the IDL_tomography folder to your PATH environment variable.
This can be done with Control Panel/System/Advanced/Environment Variables.
This is necessary for both the licensed and Virtual Machine versions of IDL to find libfftw3f-3.dll.</p></li>
<li><p>If you are using the IDL Virtual machine you must to the following to define the location of the tomoRecon
shareable library:</p>
<ul>
<li><p>On Linux define the environment variable TOMO_RECON_SHARE to point to the complete path to tomoRecon_linux_x86_64.so,
which is contained in the IDL_Tomography software downloaded above.
Example: <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">TOMO_RECON_SHARE=/usr/local/tomography/idl/tomoRecon_linux_x86_64.so</span></code></p></li>
<li><p>On Windows define the environment variable TOMO_RECON_SHARE to point to the complete path to tomoRecon_Win32_x86_64.dll.
Example: <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">TOMO_RECON_SHARE=C:\tomography\idl\tomoRecon_Win32_x86.dll</span></code>. This can be done in Control Panel/System as well.</p></li>
</ul>
</li>
<li><p>On Linux make sure the fftw-devel package is installed.  This is required for reconstruction.</p></li>
</ul>
</section>
</section>
<section id="file-formats">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">File formats</a><a class="headerlink" href="#file-formats" title="Permalink to this heading">¶</a></h2>
<section id="raw-data">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Raw data</a><a class="headerlink" href="#raw-data" title="Permalink to this heading">¶</a></h3>
<p>Beginning in July 2020 the raw data is stored in HDF5 files with the extension “.h5”.
There is one HDF5 file per dataset, and it contains the flat field images and the projections.
It also contains metadata including the positions of many motors on the beamline, the ring current,
the tomography data collection parameters, the sample and optics information, and more.
An ASCII text file with the extension “.config” contains the tomography data collection parameters,
the sample and optics information, and more.</p>
<p>From May 2014 to July 2020 the raw data is stored in netCDF files with the extension “.nc”.
There are three netCDF files per dataset.  Two are the flat field images collected at
the beginning and end of the scan, the third contains all of the projections.
An ASCII text file with the extension “.setup” contains the metadata,
including the sample information, x-ray energy, and pixel size.</p>
</section>
<section id="preprocessed-normalized-data">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Preprocessed (normalized) data</a><a class="headerlink" href="#preprocessed-normalized-data" title="Permalink to this heading">¶</a></h3>
<p>Beginning with the new version of <em>tomo_display</em> in January 2023 the
preprocessed data generally not written to disk at all, it is kept in memory after preprocessing.
This significantly improves the reconstruction speed.
<em>tomo_display</em> can optionally save the preprocessed data either as a netCDF file whose
name ends in “norm.nc” or an HDF5 file whose name ends in “norm.h5”.</p>
<p>Prior to January 2023 preprocessed data was written to disk as netCDF files with a file name that ends in “.volume”.
Prior to July 2020 these files were written by <em>tomo_display</em>, while from July 2020 to January 2023 they were written
by a Python script called preprocess_13bm.py.</p>
</section>
<section id="reconstructed-data">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Reconstructed data</a><a class="headerlink" href="#reconstructed-data" title="Permalink to this heading">¶</a></h3>
<p>eginning with the new version of <em>tomo_display</em> in January 2023 tomo_display can store reconstructed files in either netCDF format with a file
name that ends in “recon.nc”, or in HDF5 format with a file name that ends in “recon.h5”.  HDF5 is 2-3 times
faster to write, and is generally recommended.  However, there are some limitations in reading HDF5 files into
ImageJ which are discussed below.</p>
<p>Prior to January 2023 the reconstructed files were stored in netCDF format with a file name that ends
in “recon.volume”.</p>
</section>
</section>
<section id="tomo-display-quick-start">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">tomo_display Quick Start</a><a class="headerlink" href="#tomo-display-quick-start" title="Permalink to this heading">¶</a></h2>
<p>If you are running the licensed version of IDL then start IDL and type the IDL command <em>tomo_display</em>.
If you are running the IDL Virtual Machine on Windows then double-click on the tomo_display.sav file,
or open the IDL Virtual Machine from the Windows Start menu and browse for the file.
On Linux type the command <code class="docutils literal notranslate"><span class="pre">idl</span> <span class="pre">-vm=tomo_display.sav</span></code></p>
<p>When tomo_display first opens it looks like this:</p>
<figure class="align-center" id="id1">
<img alt="_images/tomo_display_start.png" src="_images/tomo_display_start.png" />
<figcaption>
<p><span class="caption-text"><strong>tomo_display window on startup</strong></span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Note that all regions of the screen are disabled.</p>
<section id="read-camera-file">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Read camera file</a><a class="headerlink" href="#read-camera-file" title="Permalink to this heading">¶</a></h3>
<p>To begin process use the <strong>File/Read camera file</strong> menu to browse for a raw data file.  This can be a single .h5 for recent data,
or any of the 3 .nc files for pre-2020 dataset.  After reading the file the screen will look like this:</p>
<figure class="align-center" id="id2">
<img alt="_images/tomo_display_after_read_camera.png" src="_images/tomo_display_after_read_camera.png" />
<figcaption>
<p><span class="caption-text"><strong>tomo_display window after reading a camera file</strong></span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Note the the Preprocess, Visualize, and Movies screen regions are now enabled.</p>
</section>
<section id="visualizing-raw-data">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Visualizing raw data</a><a class="headerlink" href="#visualizing-raw-data" title="Permalink to this heading">¶</a></h3>
<p>Pressing the <strong>Display slice</strong> button in the Visualize region opens an <strong>image_display</strong> window like this:</p>
<figure class="align-center" id="id3">
<img alt="_images/image_display_raw.png" src="_images/image_display_raw.png" />
<figcaption>
<p><span class="caption-text"><strong>image_display window showing the raw camera data in the Z direction (projection)</strong></span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="preprocessing">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Preprocessing</a><a class="headerlink" href="#preprocessing" title="Permalink to this heading">¶</a></h3>
<p>Pressing the Preprocess button in the Preprocess region will perform preprocessing.  This consists of</p>
<ul class="simple">
<li><p>Subtracting the dark current from all flat fields and projections</p></li>
<li><p>Averaging the flat fields and removing zingers (hot pixels) from them using double-correlation</p></li>
<li><p>Dividing each projection by the average flat field, and multiplying by a scale factor (default=10000)</p></li>
<li><p>Removing zingers from the normalized projections</p></li>
<li><p>If the <strong>Data type</strong> is UInt16 converts to that data type.  Float32 should normally be used if not saving to disk.</p></li>
<li><p>Optionally saving the normalized data to an HDF5 or netCDF file</p></li>
</ul>
<p>After preprocessing the screen will look like this:</p>
<figure class="align-center" id="id4">
<img alt="_images/tomo_display_after_preprocess.png" src="_images/tomo_display_after_preprocess.png" />
<figcaption>
<p><span class="caption-text"><strong>tomo_display window after preprocessing</strong></span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="visualizing-normalized-data">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Visualizing normalized data</a><a class="headerlink" href="#visualizing-normalized-data" title="Permalink to this heading">¶</a></h3>
<p>Pressing the <strong>Display slice</strong> button in the Visualize region with Direction=Z opens an <strong>image_display</strong> window like this:</p>
<figure class="align-center" id="id5">
<img alt="_images/image_display_normalized_Z.png" src="_images/image_display_normalized_Z.png" />
<figcaption>
<p><span class="caption-text"><strong>image_display window showing the normalized projection in the Z direction (projection)</strong></span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Pressing the <strong>Display slice</strong> button in the Visualize region with Direction=Y opens an <strong>image_display</strong> window like this:</p>
<figure class="align-center" id="id6">
<img alt="_images/image_display_normalized_Y.png" src="_images/image_display_normalized_Y.png" />
<figcaption>
<p><span class="caption-text"><strong>image_display window showing the normalized projection in the Y direction (sinogram)</strong></span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="optimizing-rotation-center">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Optimizing rotation center</a><a class="headerlink" href="#optimizing-rotation-center" title="Permalink to this heading">¶</a></h3>
</section>
<section id="reconstruction">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Reconstruction</a><a class="headerlink" href="#reconstruction" title="Permalink to this heading">¶</a></h3>
</section>
</section>
<section id="visualize-with-imagej">
<h2><a class="toc-backref" href="#id23" role="doc-backlink">Visualize with ImageJ</a><a class="headerlink" href="#visualize-with-imagej" title="Permalink to this heading">¶</a></h2>
<section id="limitations-in-imagej">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Limitations in ImageJ</a><a class="headerlink" href="#limitations-in-imagej" title="Permalink to this heading">¶</a></h3>
</section>
</section>
<section id="scripting-and-batch-processing">
<h2><a class="toc-backref" href="#id25" role="doc-backlink">Scripting and batch processing</a><a class="headerlink" href="#scripting-and-batch-processing" title="Permalink to this heading">¶</a></h2>
</section>
<section id="benchmarks">
<h2><a class="toc-backref" href="#id26" role="doc-backlink">Benchmarks</a><a class="headerlink" href="#benchmarks" title="Permalink to this heading">¶</a></h2>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Mark Rivers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>