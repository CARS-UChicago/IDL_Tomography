<!-- This file was generated by mk_html_help.pro -->
<html>
 
<head>
<TITLE>CARS Tomography Routines</TITLE>
</head>
 
<body>
<H1>CARS Tomography Routines</H1>
<P>
This page was created by the IDL library routine 
<CODE>mk_html_help</CODE>.  For more information on 
this routine, refer to the IDL Online Help Navigator 
or type: <P>
<PRE>     ? mk_html_help</PRE><P>
at the IDL command line prompt.<P>
<STRONG>Last modified: </STRONG>Sun Mar 26 16:20:15 2023.<P>
 
<HR>
 
<A NAME="ROUTINELIST">
<H1>List of Routines</H1></A>
<UL>
<LI><A HREF="#BACKPROJECT">BACKPROJECT</A>
<LI><A HREF="#GRIDREC">GRIDREC</A>
<LI><A HREF="#READ_TOMO_VOLUME">READ_TOMO_VOLUME</A>
<LI><A HREF="#RECONSTRUCT_SLICE">RECONSTRUCT_SLICE</A>
<LI><A HREF="#REMOVE_TOMO_ARTIFACTS">REMOVE_TOMO_ARTIFACTS</A>
<LI><A HREF="#SINOGRAM">SINOGRAM</A>
<LI><A HREF="#TOMO::CORRECT_ROTATION_TILT">TOMO::CORRECT_ROTATION_TILT</A>
<LI><A HREF="#TOMO::GET_STRUCT">TOMO::GET_STRUCT</A>
<LI><A HREF="#TOMO::GET_VOLUME">TOMO::GET_VOLUME</A>
<LI><A HREF="#TOMO::INIT">TOMO::INIT</A>
<LI><A HREF="#TOMO::OPTIMIZE_CENTER">TOMO::OPTIMIZE_CENTER</A>
<LI><A HREF="#TOMO::PREPROCESS">TOMO::PREPROCESS</A>
<LI><A HREF="#TOMO::READ_CAMERA_FILE">TOMO::READ_CAMERA_FILE</A>
<LI><A HREF="#TOMO::READ_SAMPLE_CONFIG">TOMO::READ_SAMPLE_CONFIG</A>
<LI><A HREF="#TOMO::READ_SETUP">TOMO::READ_SETUP</A>
<LI><A HREF="#TOMO::READ_VOLUME">TOMO::READ_VOLUME</A>
<LI><A HREF="#TOMO::RECONSTRUCT_VOLUME">TOMO::RECONSTRUCT_VOLUME</A>
<LI><A HREF="#TOMO::RESTORE_SETTINGS">TOMO::RESTORE_SETTINGS</A>
<LI><A HREF="#TOMO::SAVE_SETTINGS">TOMO::SAVE_SETTINGS</A>
<LI><A HREF="#TOMO::SET_PREPROCESS_PARAMS">TOMO::SET_PREPROCESS_PARAMS</A>
<LI><A HREF="#TOMO::SET_RECON_PARAMS">TOMO::SET_RECON_PARAMS</A>
<LI><A HREF="#TOMO::WRITE_SAMPLE_CONFIG">TOMO::WRITE_SAMPLE_CONFIG</A>
<LI><A HREF="#TOMO::WRITE_VOLUME">TOMO::WRITE_VOLUME</A>
<LI><A HREF="#TOMO_FILTER">TOMO_FILTER</A>
<LI><A HREF="#WRITE_TOMO_VOLUME">WRITE_TOMO_VOLUME</A>
</UL><P>
 
<HR>
 
<H1>Routine Descriptions</H1>
<A NAME="BACKPROJECT">
<H2>BACKPROJECT</H2></A>
<A HREF="#GRIDREC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   BACKPROJECT

 PURPOSE:
   Reconstructs a sinogram into an image using backprojection.

 CATEGORY:
   Tomography data processing

 CALLING SEQUENCE:
   Result = BACKPROJECT(tomoParams, Sinogram, Angles)

 INPUTS:
   Sinogram:
       The input sinogram, dimensions NX x NANGLES.  This should have been 
       filtered before calling this function.
   Angles:
       An array of dimensions NANGLES which contains the angle in degrees of 
       each projection.

 OUTPUTS:
   This function returns the reconstructed image.

 PROCEDURE:
   This function simply calls the IDL RIEMANN procedure for each row in the 
   sinogram, using the ROW and BACKPROJECT keywords.  The BILINEAR and CUBIC 
   keywords are passed from BACKPROJECT to RIEMANN if they are present.

 EXAMPLE:
   r = backproject(sinogram, angles)

 MODIFICATION HISTORY:
   Written by:     Mark Rivers, May 13, 1998
</PRE><P>
<STRONG>(See backproject.pro)</STRONG><P>
<HR>
 
<A NAME="GRIDREC">
<H2>GRIDREC</H2></A>
<A HREF="#BACKPROJECT">[Previous Routine]</A>
<A HREF="#READ_TOMO_VOLUME">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   GRIDREC

 PURPOSE:
   Performs tomographic reconstruction using the "gridrec" algorithm written
   by Bob Marr and Graham Campbell (not sure about authors) at BNL in 1997.
   The basic algorithm is based on FFTs.  It reconstructs 2 data sets at once, 
   one in the real part of the FFT and one in the imaginary part.

   This routine is 20-40 times faster than BACKPROJECT, and yields virtually
   identical reconstructions.

   This file uses CALL_EXTERNAL to call GridrecIDL.c which is a thin
   wrapper to grid.c, 

 CATEGORY:
   Tomography data processing

 CALLING SEQUENCE:
   GRIDREC, tomoParams, Sinogram1, Sinogram2, Angles, Image1, Image2

 INPUTS:
   Sinogram1:
       The first input sinogram, dimensions NX x NANGLES.  
   Sinogram2:
       The second input sinogram, dimensions NX x NANGLES.  
   Angles:
       An array of dimensions NANGLES which contains the angle in degrees of 
       each projection.

 KEYWORD PARAMETERS:
   CENTER: The column containing the rotation axis.  The default is the center
           of the sinogram.

 OUTPUTS:
   Image1:
       The reconstructed image from Sinogram1.  
   Image2:
       The reconstructed image from Sinogram2.  

   Note that the sizes of Image1 and Image2 are controlled by "grid" and will not 
   be equal NX*NX.  RECONSTRUCT_SLICE uses the IDL routine CONGRID to resize the 
   images to be NX*NX.

 PROCEDURE:
   This function uses CALL_EXTERNAL to call the shareable library GridrecIDL, 
   which is written in C.

 RESTRICTIONS:
   GRIDREC locates the GridrecIDL shareable library via the environment variable
   GRIDREC_SHARE.  This environment variable must be defined and must contain the
   name (typically including the path) to a valid shareable library or DLL.

 EXAMPLE:
   GRIDREC, s1, s2, angles, image1, image2, center=419

 MODIFICATION HISTORY:
   Written by:     Mark Rivers, March 4, 2000
   19-APR-2001 MLR Change units of ANGLES from radians to degrees.  Write
                   documentation header.
</PRE><P>
<STRONG>(See gridrec.pro)</STRONG><P>
<HR>
 
<A NAME="READ_TOMO_VOLUME">
<H2>READ_TOMO_VOLUME</H2></A>
<A HREF="#GRIDREC">[Previous Routine]</A>
<A HREF="#RECONSTRUCT_SLICE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   READ_TOMO_VOLUME

 PURPOSE:
   Reads in 3-D volume files written by WRITE_TOMO_VOLUME or TOMO::WRITE_VOLUME.
   This function is a simple wrapper around TOMO::READ_VOLUME.
   See the documentation for <A HREF="#TOMO::READ_VOLUME">TOMO::READ_VOLUME </A>
   for information on the input parameters and other details.

 PROCEDURE:
   This function simply creates a TOMO object and calls TOMO::READ_VOLUME.

 EXAMPLE:
   volume = READ_TOMO_VOLUME('diamond2.volume')

 MODIFICATION HISTORY:
   Written by: Mark Rivers, May 13, 1998
   06-APR-1999  MLR  Made file input optional, puts up dialog if it is not 
                     specified
   25-JAN-2000  MLR  Added /swap_if_big_endian keyword to openr to allow
                     files to be read on big-endian machines.
   23-FEB-2000  MLR  Added xrange, yrange, zrange keywords
   11-APR-2001  MLR  Put the original version in the TOMO class library, made this
                     function simply create a TOMO object and call TOMO::READ_VOLUME.
</PRE><P>
<STRONG>(See read_tomo_volume.pro)</STRONG><P>
<HR>
 
<A NAME="RECONSTRUCT_SLICE">
<H2>RECONSTRUCT_SLICE</H2></A>
<A HREF="#READ_TOMO_VOLUME">[Previous Routine]</A>
<A HREF="#REMOVE_TOMO_ARTIFACTS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   RECONSTRUCT_SLICE

 PURPOSE:
   Reconstructs a single slice in a tomography volume array.

 CALLING SEQUENCE:
   Result = RECONSTRUCT_SLICE(INPUT, CENTER=CENTER, SINOGRAM=SINOGRAM, COG=COG)

 INPUTS:
   INPUT:  The slice to be reconstructed, dimensions [NX, N_PROJECTIONS]

 INPUT KEYWORD PARAMETERS:
   CENTER:
     The rotation center.  If this keyword is not specified then the
     center is assumed to be the center pixel of the slice.

 OUTPUT KEYWORD PARAMETERS:
   SINOGRAM:
     The computed sinogram. This can only be returned when the reconstruction method is
     Gridrec or Backproject, not tomoRecon.
   COG:
     The center of gravity of the sinogram, 1-D array. This can only be returned when the reconstruction method is
     Gridrec or Backproject, not tomoRecon.

 OUTPUTS:
   This function returns the reconstructed slice.  It is a floating point array of dimensions [NX, NX]

 PROCEDURE:
   Reconstructs the slice with the current reconstruction parameters set with TOMO::SET_RECON_PARAMS.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="REMOVE_TOMO_ARTIFACTS">
<H2>REMOVE_TOMO_ARTIFACTS</H2></A>
<A HREF="#RECONSTRUCT_SLICE">[Previous Routine]</A>
<A HREF="#SINOGRAM">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   REMOVE_TOMO_ARTIFACTS

 PURPOSE:
   Removes artifacts from tomography images and sinograms.

 CATEGORY:
   Tomography data processing

 CALLING SEQUENCE:
   Result = REMOVE_TOMO_ARTIFACTS(Image)

 INPUTS:
   Image:  The input array from which artifacts are to be removed.

 KEYWORD PARAMETERS:
   IMAGE2:
       A second input and output image when doing DOUBLE_CORRELATION
   ZINGERS:
       Set this keyword to remove zingers from the input image
   DOUBLE_CORRELATION:
       Set this keyword to remove zingers from the input using double 
       correlation rather than a spatial detection
   RINGS:
       Set this keyword to remove ring artifacts from a sinogram
   DIFFRACTION:
       Set this keyword to removed diffraction artifacts from a sinogram
   WIDTH:          
       Set this keyword to adjust the size of the filter kernal used in the
       artifact removal.  The default is 9 pixels.
   THRESHOLD:  
       Set this keyword to adjust the threshold used in detecting zingers and
       diffraction artifacts.  The defaults are 1.2 for /ZINGER and 
       /DOUBLE_CORRELATION and 0.8 for/DIFFRACTION
   DEBUG:      
       Set this keyword to print debugging information

 OUTPUTS:
   This function returns an image with the specified artifacts removed.

 PROCEDURE:
   THIS STILL NEEDS TO BE DOCUMENTED.  For now, see the source code.

 EXAMPLE:
   r = remove_tomo_artifacts(sinogram, /Rings)

 MODIFICATION HISTORY:
   Written by:     Mark Rivers, May 13, 1998
   MLR 4/4/99 MLR  Added DOUBLE_CORRELATION keyword
   MLR 4/5/99 MLR  Added /EDGE_TRUNCATE to all calls to SMOOTH so that
                   smoothing works to the edges of the image
</PRE><P>
<STRONG>(See remove_tomo_artifacts.pro)</STRONG><P>
<HR>
 
<A NAME="SINOGRAM">
<H2>SINOGRAM</H2></A>
<A HREF="#REMOVE_TOMO_ARTIFACTS">[Previous Routine]</A>
<A HREF="#TOMO::CORRECT_ROTATION_TILT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   SINOGRAM

 PURPOSE:
   To convert raw tomography data into a sinogram.

 CATEGORY:
   Tomography

 CALLING SEQUENCE:
   result = SINOGRAM(Input, Angles)

 INPUTS:
   Input
       An array of raw tomography data. INPUT(I, J) is the intensity at
       position I for view angle J. Each row is assumed to contain at least
       one air value at each end for normalization.
   Angles
       An array of the angles of each row of the input.  Units are degrees.

   COG=cog
       This keyword is used to return the measured and fitted
       center-of-gravity data for the sinogram. The center-of-gravity data are
       very useful for diagnosing problems such as backlash, beam hardening,
       detector saturation, etc. COG is dimensioned (n_angles, 2), where
       n_angles is the number of angles in the input array. COG(*,0) is the
       measured center-of-gravity data. COG(*,1) is the fitted data. The
       following command can then be given after the SINOGRAM command
       IDL> PLOT, COG(*,0)
       IDL> OPLOT, COG(*,1)
       to see is the sinogram data are reasonable.
 RETURN:
       The output array containing the corrected sinogram. It is always of
       type FLOAT.

 PROCEDURE:
       This routine creates a sinogram from raw tomography data. It does the
       following:
       -   Averages the air values for "airPixels" pixels on the left and 
           right hand sides of the input.
       -   Logarithmation. output = -log(input/air). The air values are
           interpolated between the averaged values for the left and right 
           hand edges of the image for each row.  This step is not performed
           if the /FLUORESCENCE keyword is set.
       -   The measured center-of-gravity is fitted to a sinusoidal curve
           of the form Y = A(0) + A(1)*SIN(X + A(2)).
               A(0) is the rotation axis
               A(1) is the amplitude
               A(2) is the phase
           The fitting is done using routine CURVE_FIT in the User Library.
           The shifting is done using routine POLY_2D which can shift by 
           fractional pixels.
 MODIFICATION HISTORY:
   Created 21-OCT-1991 by Mark Rivers.
</PRE><P>
<STRONG>(See sinogram.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::CORRECT_ROTATION_TILT">
<H2>TOMO::CORRECT_ROTATION_TILT</H2></A>
<A HREF="#SINOGRAM">[Previous Routine]</A>
<A HREF="#TOMO::GET_STRUCT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
  TOMO::CORRECT_ROTATION_TILT

 PURPOSE:
   This procedure rotates each projection by the specified angle.
   It can be used to correct for the rotation center not being parallel to the columns of the camera.

 CALLING SEQUENCE:
   TOMO->CORRECT_ROTATION_TILT, ANGLE

 INPUT PARAMETERS:
   ANGLE (required)
     The angle in degrees clockwise by which to rotate each projection.

; PROCEDURE:
   Uses the IDL ROT function.  tomo::pVolume is modified in place.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::GET_STRUCT">
<H2>TOMO::GET_STRUCT</H2></A>
<A HREF="#TOMO::CORRECT_ROTATION_TILT">[Previous Routine]</A>
<A HREF="#TOMO::GET_VOLUME">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::GET_STRUCT

 PURPOSE:
   This function returns the member variables of the tomo class as a structure
   It is provided because IDL class member variables are always private.

 CALLING SEQUENCE:
   result = TOMO->GET_STRUCT()

 RETURN VALUE:
   Returns the tomo object member variables as a structure.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::GET_VOLUME">
<H2>TOMO::GET_VOLUME</H2></A>
<A HREF="#TOMO::GET_STRUCT">[Previous Routine]</A>
<A HREF="#TOMO::INIT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::GET_VOLUME

 PURPOSE:
   This function returns self.pVolume.
   This is a pointer to raw, normalized, or reconstructed data, depending on the most recent operation performed.
   It is an IDL pointer, so does not involve a copy operation.

 CALLING SEQUENCE:
   result = TOMO->GET_VOLUME()

 RETURN VALUE:
   Returns self.pVolume.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::INIT">
<H2>TOMO::INIT</H2></A>
<A HREF="#TOMO::GET_VOLUME">[Previous Routine]</A>
<A HREF="#TOMO::OPTIMIZE_CENTER">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::INIT

 PURPOSE:
   This function is called implicitly when a new TOMO object is created.
   It initializes all member variables to reasonable defaults.

 CALLING SEQUENCE:
   TOMO = OBJ_NEW('TOMO', KEYWORD=VALUE, ...)

 KEYWORD PARAMETERS:
   settingsFile   Name of a settings file previously saved with TOMO::SAVE_SETTINGS
   statusWidget   Widget ID of a status widget.  TOMO methods will write status strings to this widget if specified.
   abortWidget    Widget ID of an abort width.  TOMO methods monitor this widget to know when to abort operations.
   debugLevel     Debugging level for messages
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::OPTIMIZE_CENTER">
<H2>TOMO::OPTIMIZE_CENTER</H2></A>
<A HREF="#TOMO::INIT">[Previous Routine]</A>
<A HREF="#TOMO::PREPROCESS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
  TOMO::OPTIMIZE_CENTER

 PURPOSE:
   This procedure performs the preprocessing on a tomography dataset, producing normalized data that
   is corrected for dark fields, flat fields, and zingers.
   The data must have been read into the tomo object with tomo::read_camera_file.
   The preprocessing parameters can be specified before calling this function with tomo::set_preprocess_params.

 CALLING SEQUENCE:
   TOMO->OPTIMIZE_CENTER, SLICES, CENTER, MERIT, WIDTH=WIDTH, STEP=STEP, METHOD=METHOD

 INPUT PARAMETERS:
   SLICES (required)
     A 2-element array containing the slice numbers to use for optimization.
     Normally one should be near the top of the projections and the other near the bottom
   CENTER (required)
     The initial guess of the optimum rotation center.
     
 OUTPUT PARAMETERS:
   MERIT:
     An array of [2, nCenter] where nCenter = WIDTH/STEP + 1. 
     This array contains the figure of merit for each rotation center for the upper and lower slices.  
     The minimum value is nominally the best rotation center.

 KEYWORD PARAMETERS
   WIDTH:
     The full-width of the rotation center search region in pixels. Default=10.
   STEP:
     The step size within the WIDTH for each trial rotation center.  
     Default=0.5 if METHOD='0-180' and 0.25 if METHOD='Entropy'.
   METHOD:
     The optimization method.  Valid choices are '0-180' and 'Entropy'.
     
 PROCEDURE:
   The IDL tomography documentation (https://CARS-UChicago.github.io/IDL_tomography) explains
   the optimization algorithms in detail.
   
   After the optimization the two slice numbers and the minimum values of MERIT are passed
   to TOMO::SET_ROTATION.  That routine sets tomo::rotationCenter and tomo::rotationCenterSlope
   which are used to set the rotation center of each slice during reconstruction.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::PREPROCESS">
<H2>TOMO::PREPROCESS</H2></A>
<A HREF="#TOMO::OPTIMIZE_CENTER">[Previous Routine]</A>
<A HREF="#TOMO::READ_CAMERA_FILE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
  TOMO::PREPROCESS

 PURPOSE:
   This procedure performs the preprocessing on a tomography dataset, producing normalized data that
   is corrected for dark fields, flat fields, and zingers.
   The data must have been read into the tomo object with tomo::read_camera_file.
   The preprocessing parameters can be specified before calling this function with tomo::set_preprocess_params.

 CALLING SEQUENCE:
   TOMO->PREPROCESS

 PROCEDURE:
   This function performs the following steps:
   - Averages the dark fields if there is more than 1
   - Subtracts the dark current from each flat field field frame,
   - Removes zingers from flat field frames using REMOVE_TOMO_ARTIFACTS with
     /DOUBLE_CORRELATION if there is more than 1, or /ZINGERS if there is only 1.
   - Averages the flat fields if there is more than 1.
   - Calls the C++ code in tomoRecon to do the following:
     - Subtracts the dark current from each projection 
     - Divides projection by the average flat field
     - Removes zingers using a median filter with zingerWidth and zingerThreshold
     - Scales the normalized projection by preprocessScale
   - Optionally converts the normalized projections to UInt16 if preprocessDataType = 'UInt16'
   - Optionally writes the normalized data frames to a single disk file if .preprocessWriteOutput is true.
     The file can be written in HDF5 or netCDF format.
   - Replaces the raw data in tomo::pVolume with the normalized data.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::READ_CAMERA_FILE">
<H2>TOMO::READ_CAMERA_FILE</H2></A>
<A HREF="#TOMO::PREPROCESS">[Previous Routine]</A>
<A HREF="#TOMO::READ_SAMPLE_CONFIG">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
  TOMO::READ_CAMERA_FILE

 PURPOSE:
   This procedure reads a tomography data set from 2 types of data files:
     - netCDF files.  There are 4 files
       - base_1.nc contains flat fields collected at the beginning
       - base_2.nc contains the projections
       - base_3.nc contains the flat fields collected at the end
       - base.setup ASCII file containing metadata including the pixel size and dark current.
       
     - HDF5 files.  There are 2 files:
       - base.h5     A single file HDF5 that contains the flat fields, dark fields, projections, and metadata
       - base.config An ASCII file containing metadata. 

 INPUT PARAMETERS:
   FILENAME (required):
     For netCDF this can be the name of any of the 3 netCDF files
     For HDF5 this is the name of the HDF5 file

 PROCEDURE:
   Reads the data into the tomo object, including these member variables
     nx, ny, nz
     xPixelSize, yPixelSize, zPixelSize
     pAngles
     pFlats
     pDarks
     pData
     rotationCenter       Initialized to nx/2
     rotationCenterSlope  Initialize to 0
  For netCDF files reads the .setup file with tomo::read_setup
  For HDF5 files reads the .config file with tomo::read_sample_config
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::READ_SAMPLE_CONFIG">
<H2>TOMO::READ_SAMPLE_CONFIG</H2></A>
<A HREF="#TOMO::READ_CAMERA_FILE">[Previous Routine]</A>
<A HREF="#TOMO::READ_SETUP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::READ_SAMPLE_CONFIG

 PURPOSE:
   This procedure reads some of fields in the JSON .config file into tomo object variables.

 CALLING SEQUENCE:
   TOMO->READ_SAMPLE_CONFIG, FILE
   
 INPUTS:
   FILE:  The name of the file to read. Optional, default is self.baseFileName + '.config'

 PROCEDURE:
   This is the list of JSON fields and tomo object variables
     RotationCenter  self.rotatinCenter
     RotationSlose   self.rotationCenterSlope
     UpperSlice      self.upperSlice
     LowerSlice      self.lowerSlice
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::READ_SETUP">
<H2>TOMO::READ_SETUP</H2></A>
<A HREF="#TOMO::READ_SAMPLE_CONFIG">[Previous Routine]</A>
<A HREF="#TOMO::READ_VOLUME">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::READ_SETUP

 PURPOSE:
   This function reads the setup information for a tomography data set from an ASCII file.
   NOTE: These .setup files are present for pre-2020 data collected with raw data in netCDF format
   They contain original metadata including the dark current.
   Previously the tomo class re-wrote these files with new metadata, including the rotation center.
   The current processing software only reads these .setup files, and write the new metadata to the .config file.

 CALLING SEQUENCE:
   result = TOMO->READ_SETUP(FILE)

 INPUTS:
   File:
     The name of the input .setup file.

 OUTPUTS:
   The data read from the file is read into the following fields in the tomo object
     *self.pDarks
     self.rotationCenter
     self.[x,y,z]PixelSize
     self.pConfig[SampleDescription1, UserName, Camera, SampleName, DarkFieldValue, Energy, ImagePixelSize]
 
 RETURN VALUE:
   The function returns 0 if it was unable to read the file, 1 if it was successful.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::READ_VOLUME">
<H2>TOMO::READ_VOLUME</H2></A>
<A HREF="#TOMO::READ_SETUP">[Previous Routine]</A>
<A HREF="#TOMO::RECONSTRUCT_VOLUME">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::READ_VOLUME

 PURPOSE:
   Reads in 3-D volume files written by TOMO::WRITE_VOLUME.
   These are HDF5 and netCDF format.

 CALLING SEQUENCE:
   Result = READ_TOMO_VOLUME(FILE, STORE=STORE, XRANGE=XRANGE, YRANGE=YRANGE, ZRANGE=ZRANGE)

 INPUTS:
   FILE:
     The name of the volume file to be read.  If this is not specified then
     the function will use DIALOG_PICKFILE to allow the user to select a file.

; KEYWORD PARAMETERS:
   STORE
     If this keyword is set then the data is read into *self->pVolume, 
     self.nx, self,ny, and self.nz are set appropriately, and the function returns the scalar value 0.
     If this keyword is not set then the function returns the data read.
     
   The behavior of the following keywords depends on the file type:
   netCDF: Only the specified subset of the data is read from disk.
   HDF5:   The entire dataset is read from disk, but only the selected subset it returned.
           In the future this may be improved to only read the selected subset. 
   XRANGE=[xstart, xstop]
       The range of X values to read in. The default is to read the entire X range of the data
   YRANGE=[ystart, ystop]
       The range of Y values to read in. The default is to read the entire Y range of the data
   ZRANGE=[zstart, zstop]
       The range of Z values to read in. The default is to read the entire Z range of the data

 OUTPUTS:
   If the keyword STORE is not set then this function the data read.
   If the keyword is set then the function puts the data in *self.pVolume and returns 0.

 PROCEDURE:
   - Calls self->set_file_components to set self.inputFilename, self.directory, and self.baseFilename
   - For HDF files the following datasets are read if they are present
       /exchange/data              *self.pVolume or data returned by function
       /process/imageType          self.imageType
       /process/angles             *self.pAngles
       /process/[x,y,z]PixelSize   self.[x,y,z]PixelSize
   - For netCDF files the following variables and global attributes are read if present
       VOLUME                      *self.pVolume or data returned by function
       imageType                   self.imageType
       angles                      *self.pAngles
       scale_factor                self.preprocessScale
       [x,y,z]PixelSize            self.[x,y,z]PixelSize
       title                       self.pSampleConfig['SampleDescription1']
       operator                    self.pSampleConfig['UserName']
       camera                      self.pSampleConfig['Camera']
       sample                      self.pSampleConfig['SampleName']
       energy                      self.pSampleConfig['Energy']
       dark_current                self.pSampleConfig['DarkFieldValue'], *self.pDarks
       center                      self.rotationCenter
   - Calls self->read_sample_config to read additional metadata that is stored in that file
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::RECONSTRUCT_VOLUME">
<H2>TOMO::RECONSTRUCT_VOLUME</H2></A>
<A HREF="#TOMO::READ_VOLUME">[Previous Routine]</A>
<A HREF="#TOMO::RESTORE_SETTINGS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::RECONSTRUCT_VOLUME

 PURPOSE:
   This procedure reconstructs a complete 3-D data set (X, Y, Theta) into a 3-D (X, Y, Z) volume.  

 CALLING SEQUENCE:
   TOMO->RECONSTRUCT_VOLUME

 PROCEDURE:
   - The input is normalized data in *self.pVolume.
   - The reconstruction is done using the parameters set in TOMO::SET_RECON_PARAMS
   - The rotation center for each slice is determined using self.rotationCenter and self.rotationCenterSlope
   - If the maximum angle is larger then 180 degrees then it is assumes the data is 360 degrees and calls
     TOMO::CONVERT_360_DATA to convert to 180.
   - If *self.pVolume is not of type FLOAT it is converted to FLOAT.
   - If self.reconMethod is tomoRecon then the reconstruction is done with TOMO::TOMO_RECON,
     otherwise it is done by reconstructing each slice with TOMO::RECONSTRUCT_SLICE.
   - The .config file is updated with TOMO::WRITE_SAMPLE_CONFIG.
     This updates the upper and lower slice numbers and rotation centers used for the reconstruction.
   - If self.reconDataType is not Float32 then the reconstructed data is converted to Int16 or UInt16.
   - If self.reconWriteOutput is not 0 then the output is written to disk by TOMO::WRITE_VOLUME,
     in the format selected by self.reconWriteFormat, i.e. 'HDF5' or 'netCDF'.
   - The output is returned in *self.pVolume, replacing the normalized data.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::RESTORE_SETTINGS">
<H2>TOMO::RESTORE_SETTINGS</H2></A>
<A HREF="#TOMO::RECONSTRUCT_VOLUME">[Previous Routine]</A>
<A HREF="#TOMO::SAVE_SETTINGS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::RESTORE_SETTINGS

 PURPOSE:
   This procedure restores the tomo settings from a file that was written by tomo::save_settings.
   The file can contain additional keys beyond those known to the tomo class, and these are ignored.
   This is the case when the file is written by the tomo_display class, since such files include
   tomo_display parameters as well.

 CALLING SEQUENCE:
   TOMO->RESTORE_SETTINGS, FILE

 INPUTS:
  FILE: Name of the file to read from to.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::SAVE_SETTINGS">
<H2>TOMO::SAVE_SETTINGS</H2></A>
<A HREF="#TOMO::RESTORE_SETTINGS">[Previous Routine]</A>
<A HREF="#TOMO::SET_PREPROCESS_PARAMS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::SAVE_SETTINGS

 PURPOSE:
   This procedure saves the current tomo settings to a file.
   The file is in JSON format.

 CALLING SEQUENCE:
   TOMO->SAVE_SETTINGS, FILE

 INPUTS:
  FILE: Name of the file to write to.
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::SET_PREPROCESS_PARAMS">
<H2>TOMO::SET_PREPROCESS_PARAMS</H2></A>
<A HREF="#TOMO::SAVE_SETTINGS">[Previous Routine]</A>
<A HREF="#TOMO::SET_RECON_PARAMS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::SET_PREPROCESS_PARAMS

 PURPOSE:
   This procedure sets the preprocess parameters.
   It uses keywords to set the appropriate tomo member variable value.
   It is typically called before calling tomo::preprocess.

 CALLING SEQUENCE:
   TOMO->SET_PREPROCESS_PARAM, keyword=value, ...

 KEYWORD PARAMETERS
   Many of these value are explained in more depth in the IDL_Tomography documentation
   at https://cars-uchicago.github.io/IDL_Tomography/processing_options.html

   zingerWidth           Number of pixel used for zinger removal. 0=disable
   zingerThreshold       Threshold for zinger removal when using median filter for projections
   zingerDoubleThreshold Threshold for zinger removal when using double correlation for flat fields
   dataType              Output data type: 'Float32' or 'UInt16'
   writeOutput           1 to write the preprocessed output data to a file, 0 to not write.
   writeFormat           Output file format: 'HDF5' or 'netCDF'
   scale                 Output scale factor.  Typically 10000.  Needed when output='UInt16'
   threads               Number of threads to use for preprocessing
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::SET_RECON_PARAMS">
<H2>TOMO::SET_RECON_PARAMS</H2></A>
<A HREF="#TOMO::SET_PREPROCESS_PARAMS">[Previous Routine]</A>
<A HREF="#TOMO::WRITE_SAMPLE_CONFIG">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::SET_RECON_PARAMS

 PURPOSE:
   This procedure sets the reconstruction parameters.
   It uses keywords to set the appropriate tomo member variable value.
   It is typically called before calling tomo::reconstruct_slice or tomo::reconstruct_volume.

 CALLING SEQUENCE:
   TOMO->SET_RECON_PARAM, keyword=value, ...
   
 KEYWORD PARAMETERS
   Many of these value are explained in more depth in the IDL_Tomography documentation
   at https://cars-uchicago.github.io/IDL_Tomography/processing_options.html
   
   rotationCenter        Rotation center for slice 0
   rotCenterSlope        Slope of the rotation in pixels/slice
   reconMethod           Reconstruction method: 'tomoRecon', 'GridRec', or 'Backproject'
   dataType              Output data type: 'Float32', 'Int16', or 'UInt16'
   writeOutput           1 to write the reconstruction to a file, 0 to not write.
   writeFormat           Output file format: 'HDF5' or 'netCDF'
   sinoScale             Scale factor that was used when preprocessing
   reconScale            Scale factor for the output.  Typically 1e6 when dataType='Int16' or 'UInt16'
   reconOffset           Offset value for the output.  Typically 32767 when dataType='UInt16'
   paddedSinogramWidth   0=auto, 1=no padding, other values typically power of 2 and larger than NX
   paddingAverage        Number of pixel to average on the image edges for padding
   airPixels             Number of air pixels to average for secondary normalization.  0=disable.
   ringWidth             Number of pixels for ring artifact reduction.  0=disable.
   fluorescence          1 if this is fluorescence data, 0 if absorption (take logarithm of sinogram).
   threads               Number of threads to use for reconstruction with tomoRecon
   slicesPerChunk        Number of slices per chunk for tomoRecon.  Not currently used.
   debug                 Debugging print level.  Larger numbers are more verbose output
   dbgFile               File to write debugging output to
   geom                  Gridrec/tomoRecon geom parameter 
   pswfParams            Gridrec/tomoRecon pswf parameter
   sampl                 Gridrec/tomoRecon sampl parameter
   maxPixSize            Gridrec/tomoRecon maxPixSize parameter
   ROI                   Gridrec/tomoRecon ROI parameter
   X0                    Gridrec/tomoRecon X0 parameter
   Y0                    Gridrec/tomoRecon Y0 parameter
   ltbl                  Gridrec/tomoRecon ltbl parameter
   GR_filterName         Gridrec/tomoRecon filter name
   BP_method             Backproject method
   BP_filterName         Backproject filter name
   BP_filterSize         Backproject filter size
   RiemannInterpolation  Riemann interpolation method
   RadonInterpolation    Radon interpolation method
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::WRITE_SAMPLE_CONFIG">
<H2>TOMO::WRITE_SAMPLE_CONFIG</H2></A>
<A HREF="#TOMO::SET_RECON_PARAMS">[Previous Routine]</A>
<A HREF="#TOMO::WRITE_VOLUME">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::WRITE_SAMPLE_CONFIG

 PURPOSE:
   This writes some tomo object variables to fields in the JSON .config file which contains metadata

 CALLING SEQUENCE:
   TOMO->WRITE_SAMPLE_CONFIG

 PROCEDURE:
   This is the list of JSON fields and tomo object variables
     RotationCenter  self.rotatinCenter
     RotationSlose   self.rotationCenterSlope
     UpperSlice      self.upperSlice
     LowerSlice      self.lowerSlice
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO::WRITE_VOLUME">
<H2>TOMO::WRITE_VOLUME</H2></A>
<A HREF="#TOMO::WRITE_SAMPLE_CONFIG">[Previous Routine]</A>
<A HREF="#TOMO_FILTER">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO::WRITE_VOLUME

 PURPOSE:
   Writes 3-D arrays containing either normalized or reconstructed data.
   There are currently 2 file formats supported, HDF5 and netCDF.

 CALLING SEQUENCE:
   TOMO->WRITE_VOLUME, FILE, VOLUME

 INPUTS:
   FILE:
     The name of the file to be written.
   VOLUME:
     The 3-D volume data to be written.  The dimensions are NX, NY, NANGLES or NX, NY, NZ

 KEYWORD PARAMETERS:
   NETCDF:
     Set this keyword  to write files in netCDF file format.  
     If NETCDF is not set then files are written in HDF5 format.

   The following keywords are currently only supported for netCDF files.
   Support for HDF5 files may be added in the future.
   XOFFSET:
   YOFFSET:
   ZOFFSET:  The [X,Y,Z] offsets in the disk array to begin writing to.  Default
             is [0,0,0]
   XMAX:
   YMAX:
   ZMAX:     The maximum [X,Y,Z] size of the array on disk.  Valid only when the
             file is first created, i.e. if APPEND is not specified.  Default
             is the size of the Volume array in each dimension.
   APPEND:   Open an existing file for appending or overwriting data.  Default is to
             APPEND=0 which creates a new file.

 PROCEDURE:
   HDF5 files will contain the following datasets
     /exchange/data                The volume array
     /process/imageType            self.imageType
     /process/angles               *self.pAngles
     /process/[x,y,z]PixelSize     self.[x,y,z]PixelSize
     /process/rotationCenter       self.rotationCenter
     /process/rotationCenterSlope  self.rotationCenter
     /process/preprocessScale      self.rotationCenterSlope
     /process/dataOffset           self.preprocessOffset or self.reconOffset depending on self.imageType
     /process/dataScale            self.preprocessScale or self.reconScale depending on self.imageType
  
  netCDF files will contain the following:
    Dimensions:  NX, NY, NZ
    Variables:   VOLUME
    Global attributes:
      title
      camera
      operator
      sample
      imageType
      energy
      dark current
      center
      [x,y,z]PixelSize
      angles
      scale_factor 
</PRE><P>
<STRONG>(See tomo__define.pro)</STRONG><P>
<HR>
 
<A NAME="TOMO_FILTER">
<H2>TOMO_FILTER</H2></A>
<A HREF="#TOMO::WRITE_VOLUME">[Previous Routine]</A>
<A HREF="#WRITE_TOMO_VOLUME">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TOMO_FILTER

 PURPOSE:
   Filters a sinogram before backprojection.  A selection of filters is
   available.

 CATEGORY:
   Tomography data processing

 CALLING SEQUENCE:
   Result = TOMO_FILTER(Sinogram, Filter_size, D)

 INPUTS:
   Sinogram:       The unfiltered sinogram.  This must be a 2-D array.

 OPTIONAL INPUTS:
   Filter_size:    The half-size of the filter in pixels.  The default is NX/4 where
                   NX is the first dimension of the sinogram.
   D:              An additional filter parameter.  The default is 1.0

 KEYWORD PARAMETERS:
   FILTER_NAME:  A case-insensitive string specifying the filter to be used.
                 Allowed values are:
                 'GEN_HAMMING'
                 'LP_COSINE'
                 'SHEPP_LOGAN'
                 'RAMLAK'
                 'NONE'
                 The default is 'SHEPP_LOGAN'
 OUTPUTS:
   This function returns the filtered sinogram.

 PROCEDURE:
   For each row in the sinogram, this function simply does the following:
       Pads the input sinogram
       Does a convolution with the appropriate filter
   The code for the filters was taken from the IDL tomography demo program
   which is included in the IDL distribution.  It would be easy to add
   additional filters in the future.

 EXAMPLE:
   f = tomo_filter(sinogram, filter_name='SHEPP_LOGAN')

 MODIFICATION HISTORY:
   Written by:     Mark Rivers, May 13, 1998
   25-Nov-2001  MLR  Changed the keywords from names of individual filters
                     (e.g. /SHEPP_LOGAN) to FILTER_NAME
                     Changed the default filter size from 32 to NX/4
</PRE><P>
<STRONG>(See tomo_filter.pro)</STRONG><P>
<HR>
 
<A NAME="WRITE_TOMO_VOLUME">
<H2>WRITE_TOMO_VOLUME</H2></A>
<A HREF="#TOMO_FILTER">[Previous Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   WRITE_TOMO_VOLUME

 PURPOSE:
   Writes 3-D volume files to be read later by READ_TOMO_VOLUME or TOMO::
   READ-VOLUME.

   This function is a simple wrapper around TOMO::WRITE_VOLUME.
   See the documentation for <A HREF="#TOMO::WRITE_VOLUME">TOMO::WRITE_VOLUME </A>
   for more information.

 CATEGORY:
   Tomography data processing

 CALLING SEQUENCE:
   WRITE_TOMO_VOLUME, File, Volume

 PROCEDURE:
   This function simply creates a TOMO object and calls TOMO::WRITE_VOLUME.

 EXAMPLE:
   WRITE_TOMO_VOLUME, 'diamond2.volume', volume

 MODIFICATION HISTORY:
   Written by:     Mark Rivers, May 13, 1998
   26-JAN-2000  MLR  Added /swap_if_big_endian keyword to openw to allow
                     files to be read on big-endian machines.
   04-MAR-2001  MLR  Added support for netCDF file format.  Added NETCDF
                     and SETUP keywords
   11-APR-2001  MLR  Put the original version in the TOMO class library, made this
                     function simply create a TOMO object and call TOMO::WRITE_VOLUME.
</PRE><P>
<STRONG>(See write_tomo_volume.pro)</STRONG><P>
<HR>
 
</body>
</html>
