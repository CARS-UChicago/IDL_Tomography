

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visualize with ImageJ &mdash; IDL Tomography Processing</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/my_theme.css?v=254ed751" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=60dbed4a"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scripting and batch processing" href="scripting.html" />
    <link rel="prev" title="Visualize with image_display" href="image_display.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            IDL Tomography
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_formats.html">File formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="tomo_display_quick_start.html">Quick Start for tomo_display</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_options.html">Processing options</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_display.html">Visualize with image_display</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Visualize with ImageJ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#netcdf-plugin">netCDF plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hdf5-plugin">HDF5 plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#incompatibility-of-netcdf-and-hdf5-plugins">Incompatibility of netCDF and HDF5 plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripting.html">Scripting and batch processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">IDL Tomography</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Visualize with ImageJ</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/imagej.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="visualize-with-imagej">
<h1>Visualize with ImageJ<a class="headerlink" href="#visualize-with-imagej" title="Link to this heading"></a></h1>
<p>ImageJ is an excellent free program for displaying and analyzing tomography data.
ImageJ for Linux, Windows, and Mac can be downloaded from the
<a class="reference external" href="https://imagej.nih.gov/ij/download.html">ImageJ Website</a>.</p>
<p>The download is a ZIP file that can be extracted to a location like <code class="docutils literal notranslate"><span class="pre">C:\ImageJ</span></code> on Windows
or <code class="docutils literal notranslate"><span class="pre">/home/user/ImageJ</span></code> or <code class="docutils literal notranslate"><span class="pre">/usr/local/ImageJ</span></code> on Linux.</p>
<section id="netcdf-plugin">
<h2>netCDF plugin<a class="headerlink" href="#netcdf-plugin" title="Link to this heading"></a></h2>
<p>The netCDF files written by <strong>tomo_display</strong> or the Python <strong>preprocess_13bm.py</strong> routines can be read into ImageJ
by copying the following files into the ImageJ/plugins folder</p>
<ul class="simple">
<li><p><a class="reference external" href="https://lmb.informatik.uni-freiburg.de/resources/opensource/imagej_plugins/07.12.12/NetCDF_.jar">netCDF jar file</a> from the University of Frieburg.</p></li>
<li><p>GSETomo_.ijm from the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL Tomography</a> repository.  See the instructions in <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Installation</span></a> for how to download this.</p></li>
</ul>
<p>Open ImageJ and select <code class="docutils literal notranslate"><span class="pre">Plugins/GSETomo</span></code>.  This will open a file browser to select a netCDF file.
The 3-D dataset in the file
will be opened as a stack in ImageJ</p>
</section>
<section id="hdf5-plugin">
<h2>HDF5 plugin<a class="headerlink" href="#hdf5-plugin" title="Link to this heading"></a></h2>
<p>There are 2 ImageJ plugins for reading HDF5 files.</p>
<ul class="simple">
<li><p>The <a class="reference external" href="https://lmb.informatik.uni-freiburg.de/resources/opensource/imagej_plugins/hdf5.html">Freiburg HDF5 plugin</a>.
This plugin can only read datasets smaller than 2 GB, so it is not useful for reading most tomography datasets.</p></li>
<li><p>The <a class="reference external" href="https://github.com/paulscherrerinstitute/ch.psi.imagej.hdf5">PSI HDF5 plugin</a>.
This plugin is also limited to reading datasets smaller than 2 GB into “real” ImageJ stacks.
However, it supports “virtual” ImageJ stacks, which can be any size.  Virtual stacks are not read into memory
in their entirety, only the currently selected slice is actually in memory.
This plugin is the one that should be used for reading GSECARS tomography data.</p></li>
</ul>
<p>To install the PSI plugin copy the latest jar file from the <a class="reference external" href="https://github.com/paulscherrerinstitute/ch.psi.imagej.hdf5/releases">PSI HDF5 releases</a> to the ImageJ/plugins folder.
NOTE: If this is being installed in FIJI, rather than ImageJ it is first necessary to uninstall the Freiburg HDF5 plugin.
This is explained in the <a class="reference external" href="https://github.com/paulscherrerinstitute/ch.psi.imagej.hdf5">PSI HDF5 plugin</a> README.md file.</p>
<p>The PSI plugin can be used directly to read the HDF5 “camera” files containing the flat fields and projections,
which are unsigned 16-bit integers.</p>
<p>Open ImageJ and select <code class="docutils literal notranslate"><span class="pre">File/Import/HDF5...</span></code>.  This will open a file browser to select an HDF5 file.
After selecting the HDF file it will open the following window to select which dataset to read:</p>
<figure class="align-center" id="id1">
<img alt="_images/ImageJ_HDF5_select.png" src="_images/ImageJ_HDF5_select.png" />
<figcaption>
<p><span class="caption-text"><strong>ImageJ HDF5 plugin dataset selection window</strong></span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>This example is for reading a “camera” HDF5 raw data file, which contains 4 datasets.
/exchange/data is the one with the projections, /exchange/data_white contains the flat fields.
Reconstruction and normalized HDF5 files only have a single dataset, /exchange/data.</p>
<p>The 3-D dataset in the file will be opened by default as a virtual stack in ImageJ.  Unchecking the <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Stack</span></code>
box in the selection window will generate an error because the dataset is larger than 2 GB.</p>
<p>The prefered data type for the reconstructed HDF5 files is signed 16-bit integers.
This produces files that are 50% of the size of 32-bit floating point, with no practical loss of precision or range.
Unfortunately, ImageJ does not directly support signed 16-bit integers, so a scaling is needed
to correctly display the values.
To read these files into ImageJ you need copy the following to the ImageJ/plugins folder.</p>
<ul class="simple">
<li><p>The latest jar file from the <a class="reference external" href="https://github.com/paulscherrerinstitute/ch.psi.imagej.hdf5/releases">PSI HDF5 releases</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Read_GSE_HDF5_recon.ijm</span></code> from the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL Tomography</a> repository.
See the instructions in <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Installation</span></a> for how to download this.</p></li>
</ul>
<p>There will then be a Plugins menu item titled “Read GSE HDF5 recon”.
Click on it and select the *recon.h5 file.  It does the following:</p>
<ul class="simple">
<li><p>Reads the HDF5 file into a virtual stack.</p></li>
<li><p>Duplicates the virtual stack to a real stack.</p></li>
<li><p>Applies scaling so that the signed 16-bit integer values are displayed correctly.</p></li>
<li><p>Closes the virtual stack.</p></li>
</ul>
<p>This is an example of a reconstructed dataset read with the macro above:</p>
<figure class="align-center" id="id2">
<img alt="_images/ImageJ_recon_stack.png" src="_images/ImageJ_recon_stack.png" />
<figcaption>
<p><span class="caption-text"><strong>ImageJ stack for HDF5 file with reconstructed data</strong></span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>It is also possible to convert a signed 16-bit integer reconstructed HDF5 file to a TIFF stack in the case of the
HDF5 file being too large to convert directly in memory. Download and run <code class="docutils literal notranslate"><span class="pre">Open_Virtual_h5_Save_tiff_Stack.ijm</span></code> from
the <a class="reference external" href="https://github.com/CARS-UChicago/IDL_tomography">IDL Tomography</a> repository. This will:</p>
<ul class="simple">
<li><p>Read the selected HDF5 file into a virtual stack.</p></li>
<li><p>Prompt you to choose a directory for saving the TIFF images.</p></li>
<li><p>Open each image in the stack one at a time, scale it, and save it into the specified directory.</p></li>
</ul>
<p>Because this method relies on opening and saving each single image in the stack, it takes longer than using
<code class="docutils literal notranslate"><span class="pre">Read_GSE_HDF5_recon.ijm</span></code>.</p>
</section>
<section id="incompatibility-of-netcdf-and-hdf5-plugins">
<h2>Incompatibility of netCDF and HDF5 plugins<a class="headerlink" href="#incompatibility-of-netcdf-and-hdf5-plugins" title="Link to this heading"></a></h2>
<p>Unfortunately the netCDF and PSI HDF5 plugins referenced above are incompatible, meaning that they cannot both be
installed in the same ImageJ installation.
This is because they both use a Java logging utility, but they use incompatible versions.
The netCDF plugin uses a much older version.
In principle this could be fixed by changing the Java source code of the netCDF plugin
to use the more recent version of the logging utility.
This is not possible, however, because the source code for that plugin appears to have been lost.
I have contacted both the author, and the chair of the department at the University of Freiburg where the
author used to work, and neither are able to find it.</p>
<p>If both plugins are needed then the workaround is to have 2 separate installations of ImageJ or FIJI.
One will have the netCDF plugin and the other the HDF5 plugin.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="image_display.html" class="btn btn-neutral float-left" title="Visualize with image_display" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="scripting.html" class="btn btn-neutral float-right" title="Scripting and batch processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Mark Rivers.
      <span class="lastupdated">Last updated on 2024-December-12.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>